All_samples.metadata <- samples.metadata %>%
dplyr::select('Tube.ID','Purpose','Fixative',
'Tank_number','Prime_treatment','Timepoint') %>%
dplyr::filter(Timepoint %in% c('baseline',
'post-prime',
'1 week recovery, post challenge'
))
All_samples.metadata
samples_metadata.all <- samples.metadata %>%
dplyr::select('Tube.ID','Purpose','Fixative',
'Tank_number','Prime_treatment','Timepoint') %>%
dplyr::filter(Timepoint %in% c('baseline',
'post-prime',
'1 week recovery, post challenge'
))
samples.metadata.LN2 <- samples_metadata.all %>% filter(Fixative %in% 'LN2')
samples.metadata.LN2
samples.metadata.LN2 %>%
dplyr::group_by(Tank_number, Prime_treatment, Timepoint) %>%
dplyr::summarise(n=n()) %>%
dplyr::arrange(Timepoint)
samples.metadata.LN2 %>%
dplyr::group_by(Prime_treatment, Timepoint) %>%
dplyr::summarise(n=n()) %>%
dplyr::arrange(Timepoint)
samples.metadata.LN2
samples.metadata.LN2 %>%
dplyr::group_by(Prime_treatment, Timepoint) %>%
dplyr::summarise(n=n()) %>%
dplyr::arrange(Timepoint)
samples_metadata <- merge(metadata,
(samples %>% filter(!Timeline %in% 'baseline')),
by = 'Tank_number')
samples_metadata <- merge(metadata,
(samples %>% dplyr::filter(!Timeline %in% 'baseline')),
by = 'Tank_number')
samples_metadata <- merge(metadata,
(samples %>% dplyr::filter(!Timepoint %in% 'baseline')),
by = 'Tank_number')
nrow(samples.metadata) == nrow(samples)
samples_metadata.all <- samples.metadata %>%
dplyr::select('Tube.ID','Purpose','Fixative',
'Tank_number','Prime_treatment','Timepoint') %>%
dplyr::filter(Timepoint %in% c('baseline',
'post-prime',
'1 week recovery, post challenge'
))
samples.metadata.LN2 <- samples_metadata.all %>% filter(Fixative %in% 'LN2')
samples.metadata.LN2 %>%
dplyr::group_by(Prime_treatment, Timepoint) %>%
dplyr::summarise(n=n()) %>%
dplyr::arrange(Timepoint)
samples_metadata <- merge(metadata,
(samples %>% dplyr::filter(!Timepoint %in% 'baseline')),
by = 'Tank_number')
samples_metadata
samples_metadata <- merge(metadata,
(samples %>% dplyr::filter(!Timepoint %in% 'baseline')),
by = 'Tank_number')
samples_metadata
samples_metadata.all <- samples.metadata %>%
dplyr::select('Tube.ID','Purpose','Fixative',
'Tank_number','Prime_treatment','Timepoint') %>%
dplyr::filter(Timepoint %in% c('baseline',
'post-prime',
'1 week recovery, post challenge'
))
samples.metadata.LN2 <- samples_metadata.all %>% filter(Fixative %in% 'LN2')
samples.metadata.LN2 %>%
dplyr::group_by(Prime_treatment, Timepoint) %>%
dplyr::summarise(n=n()) %>%
dplyr::arrange(Timepoint)
samples.metadata
samples_metadata.all
(samples %>% dplyr::filter(!Timepoint %in% 'baseline'))
samples_metadata <- merge(metadata,
(samples %>% dplyr::filter(!Timepoint %in% 'baseline')),
by = 'Tank_number')
nrow(samples.metadata) == nrow(samples)
samples.metadata
samples_metadata.all <- samples.metadata %>%
dplyr::select('Tube.ID','Purpose','Fixative',
'Tank_number','Prime_treatment','Timepoint') %>%
dplyr::filter(Timepoint %in% c('post-prime',
'1 week recovery, post challenge'
))
samples_metadata.all
samples.metadata.LN2 <- samples_metadata.all %>% filter(Fixative %in% 'LN2')
samples.metadata.LN2 %>%
dplyr::group_by(Prime_treatment, Timepoint) %>%
dplyr::summarise(n=n()) %>%
dplyr::arrange(Timepoint)
library(lmtest) # to receive p value from betareg model
library(FSA) # for the Dun test post hoc for SRH non-parametric 2 way anova]
library(emmeans)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(car)
library(lmerTest)
library(lmtest) # to receive p value from betareg model
library(FSA) # for the Dun test post hoc for SRH non-parametric 2 way anova]
library(emmeans)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(car)
library(lmerTest)
library(tidyr)
library(tidyverse)
library(reshape2)
library(reshape2)
library(ggpubr)
library(reshape2)
library(ggpubr)
library(nlme)
library(rcompanion) # to run the Schrier -Ray-Hare non parametric 2 way
library(rcompanion) # to run the Schrier -Ray-Hare non parametric 2 way
knitr::opts_knit$set(root.dir = "C:/Users/gurrs/Documents/Github_repositories/Pmagellanicus_omics/RAnalysis") # sets the working directory for the entire R markdown file - no need to reload the wd
# getwd()
# read data
data  <- read.csv(file="C:/Users/samjg/Documents/Github_repositories/Pmagellanicus_omics/RAnalysis/Data/Flow_cytometry/Cell_viability_raw.csv", header = TRUE)  %>%
# dplyr::select(-c(X)) %>%
dplyr::mutate(Proportion_alive_ADJ = (Live/(Live+Dead))) %>%
dplyr::mutate(Proportion_dead_ADJ = (Dead/(Live+Dead)))
# getwd()
# read data
data  <- read.csv(file="C:/Users/gurrs/Documents/Github_repositories/Pmagellanicus_omics/RAnalysis/Data/Flow_cytometry/Cell_viability_raw.csv", header = TRUE)  %>%
# dplyr::select(-c(X)) %>%
dplyr::mutate(Proportion_alive_ADJ = (Live/(Live+Dead))) %>%
dplyr::mutate(Proportion_dead_ADJ = (Dead/(Live+Dead)))
data <- data[-1,] # omit row one, sampled 1 was redone
# View(data)
treatment_metadata <- read.csv(file="C:/Users/gurrs/Documents/Github_repositories/Pmagellanicus_omics/RAnalysis/Data/Experiment_metadata/Experiment_metadata.csv", header = TRUE) %>% dplyr::select(c(Tank_num, Temperature, OA, Color))
sample_metadata    <- read.csv(file="C:/Users/gurrs/Documents/Github_repositories/Pmagellanicus_omics/RAnalysis/Data/Experiment_metadata/Sample_metadata.csv", header = TRUE) %>% dplyr::select(-c(TagSeq_ID, ATACseq_ID))
metadata <- merge(treatment_metadata, sample_metadata)
metadata %>% group_by(OA, Temperature, Tag_color) %>% summarise(n = n())
final <- merge(data, metadata, by = "flow_cy_ID") %>%
dplyr::select(Date, Day,
Tank_num, Color, Tag_color,
Temperature, OA,
flow_cy_ID, Proportion_alive_ADJ) %>%
dplyr::mutate(population =
case_when(Tag_color %in% 'blue' ~ 'Cobscook',
TRUE ~ 'Hurricane')) %>%
dplyr::mutate(treatment =
paste0(Temperature,'_X_', OA))
final_OM <- final %>% # data %>%
# dplyr::filter(!flow_cy_ID %in% c(3,8,11,18,21,27)) %>%
# dplyr::filter(!(population %in% 'Hurricane' & Proportion_alive_ADJ < 0.18)) %>%
dplyr::mutate(OA_Pop = paste0(OA,"_",population),
Arag  = case_when(
(Temperature %in% 'High' & OA %in% 'Low') ~ 1,
(Temperature %in% 'Low' & OA %in% 'Low') ~ 2,
(Temperature %in% 'High' & OA %in% 'High') ~ 3,
(Temperature %in% 'Low' & OA %in% 'High') ~ 4))
final_OM %>% group_by(population,OA,Temperature) %>% dplyr::summarise(n=n())
# Calculate summary statistics per group
ggplot(final_OM, aes(x = factor(Temperature), y = Proportion_alive_ADJ, group=population)) +
geom_jitter(alpha = 0.5, size = 2, position=position_dodge(.4)) +
# Add mean and error bar (standard error)
stat_summary(fun = mean, geom = "point", size = 2, color = "red",position=position_dodge(.4)) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2, color = "red", position=position_dodge(.4)) +
scale_shape_manual(values=c(21, 22)) + # filled circle, filled triangle, and X
scale_fill_manual(values = c("#009E73", "#CC79A7")) +
# geom_jitter() +
theme_classic() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
ggtitle("Percent alive cells - 14 days") +
labs(y= "Percent alive cells (%)", x = "Temperature") +
facet_wrap(~OA)
# summary
summary_df <- final_OM %>% # data %>%
# edit data to suit out needs
group_by(Temperature, OA, treatment, population) %>% # group by columns for treatment
dplyr::summarise( # summarise to aquire the mean and SE for plotting
PercLive_mean = mean(Proportion_alive_ADJ), # mean
PercLive_sd = sd(Proportion_alive_ADJ), # sd
n = n(), # count
PercLive_se = PercLive_sd / sqrt(n)) # SE
# plot it
PropLive_RxnNorm <-
ggplot(final_OM, aes(x=Temperature, y=Proportion_alive_ADJ, group=OA)) +
#geom_line(aes(group = factor(population), linetype = population), size = 0.5, position=position_dodge(.4)) +  # connect a line between variables
#scale_linetype_manual(values=c("solid", "dashed")) +
# geom_point(aes(shape=OA, fill=OA), size = 4,position=position_dodge(.4)) +
geom_jitter(width = 0.15, alpha = 0.5, size = 2) + # all data points
geom_point(data = summary_df, aes(x = Temperature,
y = PercLive_mean,
shape=OA,
fill=OA),
size = 4,
position=position_dodge(.4)) +
scale_shape_manual(values=c(21, 22)) + # filled circle, filled triangle, and X
scale_fill_manual(values = c("#009E73", "#CC79A7")) +
geom_errorbar(data = summary_df, aes(x = Temperature,
y = PercLive_mean,
ymin=(PercLive_mean)-(PercLive_se),
ymax=(PercLive_mean)+(PercLive_se)),
width=.2,
position=position_dodge(.4)) +
# geom_jitter() +
theme_classic() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
ggtitle("Percent alive cells - 14 days") +
labs(y= "Percent alive cells (%)", x = "Temperature") +
facet_wrap(~population)
PropLive_RxnNorm
final_OM$treatment <- factor(final_OM$treatment,
levels=c("High_X_Low", "Low_X_Low", "High_X_High", "Low_X_High"))
PropLive_RxnNorm <- final_OM %>%
dplyr::mutate(Proportion_dead_ADJ = 1-Proportion_alive_ADJ) %>%
# dplyr::filter(!(population %in% 'Hurricane' & Proportion_alive_ADJ < 0.18)) %>%
dplyr::filter(!Proportion_alive_ADJ < 0.18) %>%
ggplot(
aes(x=treatment,
y=as.numeric(Proportion_alive_ADJ),
group=factor(OA_Pop)),
stat="identity") +
geom_point(position = position_dodge2(width = 0.2)) +
stat_summary(fun.y="mean", size = 0.8,
position = position_dodge2(width = 0.2),
color=c("black", "grey40",
"black", "grey40",
"black", "grey40",
"black", "grey40"),
shape=c(19,19,
19,19,
19,19,
19,19)) +
stat_summary(fun.min = function(x) mean(x) - sd(x)/sqrt(length(x)),
fun.max = function(x) mean(x) + sd(x)/sqrt(length(x)),
geom = 'errorbar', width = 0.25, size = 1,
position = position_dodge2(width = 0.2),
color=c("black", "grey40",
"black", "grey40",
"black", "grey40",
"black", "grey40")) +
labs(title="Percent alive cells - 14 days",
x ="Treatment",
y = "Percent alive cells (%)") +
# scale_fill_manual(breaks=c("Low pCO2", "Moderate pCO2", "High pCO2"),
#                    values=c("forestgreen","orange", "purple")) +
# scale_fill_manual(breaks=c("High pCO2", "Low pCO2"),
#                    values=c("#009E73", "#CC79A7")) +
# scale_x_discrete(labels=c("L", "M", "H")) +
# scale_y_continuous(expand = c(0, 0), limits = c(0, 0.7), breaks = seq(0, 0.7, by = 0.1)) +
theme_classic() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
# axis.title.x=element_blank(),
axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1),
axis.text=element_text(size=8),
plot.title = element_text(size=12),
legend.position="none") +
facet_wrap(~population)
PropLive_RxnNorm
# plot it
PropLive_RxnNorm <-
ggplot(final_OM, aes(x=Temperature, y=Proportion_alive_ADJ, group=OA)) +
#geom_line(aes(group = factor(population), linetype = population), size = 0.5, position=position_dodge(.4)) +  # connect a line between variables
#scale_linetype_manual(values=c("solid", "dashed")) +
# geom_point(aes(shape=OA, fill=OA), size = 4,position=position_dodge(.4)) +
geom_jitter(width = 0.15, alpha = 0.5, size = 2) + # all data points
geom_point(data = summary_df, aes(x = Temperature,
y = PercLive_mean,
shape=OA,
fill=OA),
size = 4,
position=position_dodge(.4)) +
scale_shape_manual(values=c(21, 22)) + # filled circle, filled triangle, and X
scale_fill_manual(values = c("#009E73", "#CC79A7")) +
geom_errorbar(data = summary_df, aes(x = Temperature,
y = PercLive_mean,
ymin=(PercLive_mean)-(PercLive_se),
ymax=(PercLive_mean)+(PercLive_se)),
width=.2,
position=position_dodge(.4)) +
# geom_jitter() +
theme_classic() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
ggtitle("Percent alive cells - 14 days") +
labs(y= "Percent alive cells (%)", x = "Temperature") +
facet_wrap(~population)
PropLive_RxnNorm
TwoWaymod <- aov(
lm(
Proportion_alive_ADJ ~
as.factor(Arag) * population,
data = final_OM)
)
shapiro.test(residuals(TwoWaymod))
# data:  residuals(TwoWaymod)
# W = 0.98186, p-value = 0.7581
summary(TwoWaymod)
Cobscook_mod <- lm(
Proportion_alive_ADJ ~
# OA * Temperature,
as.factor(Arag) ,
data = (final_OM %>% # data %>%
dplyr::filter(population %in% 'Cobscook')))
shapiro.test(resid(Cobscook_mod)) # 0.1339
leveneTest(Cobscook_mod) # 0.2714
summary(Cobscook_mod)
summary(
aov(
lm(
Proportion_alive_ADJ ~
# OA * Temperature,
as.factor(Arag),
data = (final_OM %>% # data %>%
dplyr::filter(population %in% 'Cobscook')) #  %>%
# dplyr::filter(!flow_cy_ID %in% c(3,8,27)) %>%
# dplyr::filter(!flow_cy_ID < 16))
)
)
)
Cobscook_Twoway <- lm(
Proportion_alive_ADJ ~
Temperature * OA,
data = (final_OM %>% # data %>%
dplyr::filter(population %in% 'Cobscook'))
)
shapiro.test(resid(Cobscook_Twoway)) # 0.1339
summary(Cobscook_Twoway)
Cobscook_Oneway <- lm(
Proportion_alive_ADJ ~
treatment,
data = (final_OM %>% # data %>%
dplyr::filter(population %in% 'Cobscook'))
)
shapiro.test(resid(Cobscook_Oneway)) # 0.1339
leveneTest(Cobscook_Oneway) # 0.5247
Hurricane_Twoway <- lm(
Proportion_alive_ADJ ~
Temperature * OA,
data = (final_OM %>% # data %>%
dplyr::filter(population %in% 'Hurricane'))
)
shapiro.test(resid(Hurricane_Twoway)) # 0.9996
summary(Hurricane_Twoway)
Hurricane_Oneway <- lm(
Proportion_alive_ADJ ~
treatment,
data = (final_OM %>% # data %>%
dplyr::filter(population %in% 'Hurricane'))
)
shapiro.test(resid(Hurricane_Oneway)) # 0.9996
leveneTest(Hurricane_Oneway) # 0.708
summary(Hurricane_Oneway)
#                     Estimate Std. Error t value Pr(>|t|)
# (Intercept)          0.41069    0.04573   8.980 1.88e-05 ***
# treatmentHigh_X_Low -0.04855    0.07468  -0.650   0.5338
# treatmentLow_X_High -0.08406    0.08556  -0.982   0.3547
# treatmentLow_X_Low  -0.20878    0.08556  -2.440   0.0406 *
mod_means_contr <- emmeans::emmeans(object = Hurricane_mod,
pairwise ~ "treatment",
adjust = "tukey")
PropLive_RxnNorm
PropLive_RxnNorm <- final_OM %>%
dplyr::mutate(Proportion_dead_ADJ = 1-Proportion_alive_ADJ) %>%
# dplyr::filter(!(population %in% 'Hurricane' & Proportion_alive_ADJ < 0.18)) %>%
dplyr::filter(!Proportion_alive_ADJ < 0.18) %>%
ggplot(
aes(x=treatment,
y=as.numeric(Proportion_alive_ADJ),
group=factor(OA_Pop)),
stat="identity") +
geom_point(position = position_dodge2(width = 0.2)) +
stat_summary(fun.y="mean", size = 0.8,
position = position_dodge2(width = 0.2),
color=c("black", "grey40",
"black", "grey40",
"black", "grey40",
"black", "grey40"),
shape=c(19,19,
19,19,
19,19,
19,19)) +
stat_summary(fun.min = function(x) mean(x) - sd(x)/sqrt(length(x)),
fun.max = function(x) mean(x) + sd(x)/sqrt(length(x)),
geom = 'errorbar', width = 0.25, size = 1,
position = position_dodge2(width = 0.2),
color=c("black", "grey40",
"black", "grey40",
"black", "grey40",
"black", "grey40")) +
labs(title="Percent alive cells - 14 days",
x ="Treatment",
y = "Percent alive cells (%)") +
# scale_fill_manual(breaks=c("Low pCO2", "Moderate pCO2", "High pCO2"),
#                    values=c("forestgreen","orange", "purple")) +
# scale_fill_manual(breaks=c("High pCO2", "Low pCO2"),
#                    values=c("#009E73", "#CC79A7")) +
# scale_x_discrete(labels=c("L", "M", "H")) +
# scale_y_continuous(expand = c(0, 0), limits = c(0, 0.7), breaks = seq(0, 0.7, by = 0.1)) +
theme_classic() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
# axis.title.x=element_blank(),
axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1),
axis.text=element_text(size=8),
plot.title = element_text(size=12),
legend.position="none") +
facet_wrap(~population)
print(PropLive_RxnNorm)
TwoWaymod <- aov(
lm(
Proportion_alive_ADJ ~
Temperature* population,
data = final_OM)
)
shapiro.test(residuals(TwoWaymod))
# data:  residuals(TwoWaymod)
# W = 0.98186, p-value = 0.7581
summary(TwoWaymod)
TwoWaymod <- aov(
lm(
Proportion_alive_ADJ ~
Temperature*OA* population,
data = final_OM)
)
shapiro.test(residuals(TwoWaymod))
# data:  residuals(TwoWaymod)
# W = 0.98186, p-value = 0.7581
summary(TwoWaymod)
knitr::opts_chunk$set(echo = TRUE)
# SET WORKING DIRECTORY
knitr::opts_knit$set(root.dir = "C:/Users/gurrs/Documents/Github_repositories/Cgigas_temperature_prime/RAnalysis") # Sam's work
library(tidyverse)
# load the raw data, just the counts of dead individuals each day
metadata <- read.csv("Data/experiment_metadata.csv", header = T, sep =',')
knitr::opts_chunk$set(echo = TRUE)
# SET WORKING DIRECTORY
knitr::opts_knit$set(root.dir = "C:/Users/gurrs/Documents/Github_repositories/Cgigas_temperature_prime/RAnalysis") # Sam's work
# load the raw data, just the counts of dead individuals each day
metadata <- read.csv("Data/experiment_metadata.csv", header = T, sep =',')
samples  <- read.csv("Data/sample_spreadsheet.csv", header = T, sep =',')
baseline_samples <- samples %>% dplyr::filter(Timepoint %in% 'baseline')
samples_metadata <- merge(metadata,
(samples %>% dplyr::filter(!Timepoint %in% 'baseline')),
by = 'Tank_number')
nrow(samples.metadata) == nrow(samples)
nrow(samples_metadata) == nrow(samples)
samples_metadata <- merge(metadata,
(samples %>% dplyr::filter(!Timepoint %in% 'baseline')),
by = 'Tank_number')
nrow(samples_metadata) == nrow(samples)
samples
samples_metadata
nrow(samples_metadata) == (nrow(samples) - nrow(baseline_samples))
# number of samples per family in LN2, N = 4
baseline_samples %>%
dplyr::filter(Fixative %in% 'LN2') %>%
dplyr::group_by(Family_ID) %>%
dplyr::summarise(n=n())
# number of samples per family in DNA RNMA shield, N = 3
baseline_samples %>%
dplyr::filter(!Fixative %in% 'LN2') %>%
dplyr::group_by(Family_ID) %>%
dplyr::summarise(n=n())
# number of samples per family in LN2, N = 4
baseline_samples %>%
dplyr::filter(Fixative %in% 'LN2') %>%
dplyr::group_by(Family_ID) %>%
dplyr::summarise(n=n())
# number of samples per family in DNA RNMA shield, N = 3
baseline_samples %>%
dplyr::filter(!Fixative %in% 'LN2') %>%
dplyr::group_by(Family_ID) %>%
dplyr::summarise(n=n())
samples_metadata.all <- samples.metadata %>%
dplyr::select('Tube.ID','Purpose','Fixative',
'Tank_number','Prime_treatment','Timepoint') %>%
dplyr::filter(Timepoint %in% c('post-prime',
'1 week recovery, post challenge'
))
samples_metadata.all <- samples_metadata %>%
dplyr::select('Tube.ID','Purpose','Fixative',
'Tank_number','Prime_treatment','Timepoint') %>%
dplyr::filter(Timepoint %in% c('post-prime',
'1 week recovery, post challenge'
))
samples.metadata.LN2 <- samples_metadata.all %>% filter(Fixative %in% 'LN2')
samples.metadata.LN2 %>%
dplyr::group_by(Prime_treatment, Timepoint) %>%
dplyr::summarise(n=n()) %>%
dplyr::arrange(Timepoint)
samples.metadata.LN2 %>%
dplyr::group_by(Prime_treatment, Timepoint,Tank_number) %>%
dplyr::summarise(n=n()) %>%
dplyr::arrange(Timepoint)
# number of samples per family in LN2, N = 4
baseline_samples %>%
dplyr::filter(Fixative %in% 'LN2') %>%
dplyr::group_by(Family_ID) %>%
dplyr::summarise(n=n())
baseline_samples %>%
dplyr::filter(Fixative %in% 'LN2')
samples_metadata.all
samples.metadata.LN2
samples.metadata.LN2 %>%
dplyr::group_by(Prime_treatment, Timepoint,Tank_number) %>%
dplyr::summarise(n=n()) %>%
dplyr::arrange(Timepoint)
nrow(samples)
View(samples)
samples_metadata %>% dplyr::group_by(Timepoint, Fixative) %>%
summarise(n = n())
samples_metadata %>% dplyr::group_by(Timepoint, Purpose) %>%
summarise(n = n())
unique(samples_metadata$Tank_number)
